# =============================================================================
# Healthcare CRM Bridge Service - Environment Configuration
# =============================================================================
# 
# This file contains all required environment variables for the Bridge service
# as specified in API v2.1 security requirements and architecture documentation.
#
# Copy this file to .env and update the values according to your environment.
#
# Security Note: Never commit the actual .env file to version control.
# =============================================================================

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

APP_NAME="Healthcare CRM Bridge"
APP_ENV=production
APP_KEY=
APP_DEBUG=false
APP_URL=https://bridge.yourdomain.com

# Application timezone
APP_TIMEZONE=America/Sao_Paulo

# Application locale for LGPD compliance
APP_LOCALE=pt_BR

# =============================================================================
# DATABASE CONFIGURATION (Read/Write Split with PgBouncer)
# =============================================================================

# Default database connection
DB_CONNECTION=pgsql

# Database credentials
DB_USERNAME=postgres
DB_PASSWORD=your_secure_password_here
DB_DATABASE=bridge

# Primary database (Write operations through PgBouncer)
DB_WRITE_HOST=pgbouncer
DB_WRITE_PORT=6432
DATABASE_WRITE_URL=pgsql://postgres:password@pgbouncer:6432/bridge

# Read replica (Read operations)
DB_READ_HOST=postgres-replica
DB_READ_PORT=5432
DATABASE_READ_URL=pgsql://postgres:password@postgres-replica:5432/bridge

# Direct connection (Administrative operations)
DB_DIRECT_HOST=postgres-primary
DB_DIRECT_PORT=5432
DATABASE_DIRECT_URL=pgsql://postgres:password@postgres-primary:5432/bridge

# Fallback connection (Legacy support)
DB_HOST=127.0.0.1
DB_PORT=5432
DATABASE_URL=pgsql://postgres:password@127.0.0.1:5432/bridge

# Database SSL configuration
DB_SSLMODE=prefer

# PgBouncer connection pooling settings
DB_POOL_MIN=5
DB_POOL_MAX=25
DB_POOL_IDLE_TIMEOUT=600

# Database performance settings
DB_QUERY_LOGGING=false
DB_SLOW_QUERY_THRESHOLD=1000
DB_CONNECTION_TIMEOUT=30
DB_STATEMENT_TIMEOUT=300
DB_QUERY_CACHING=true
DB_RESULT_CACHING=true

# Database health monitoring
DB_HEALTH_MONITORING=true
DB_HEALTH_CHECK_INTERVAL=30
DB_HEALTH_TIMEOUT=5
DB_HEALTH_RETRY_ATTEMPTS=3
DB_ALERTS_ENABLED=true
DB_ALERT_WEBHOOK_URL=https://alerts.yourdomain.com/webhook
DB_ALERT_EMAIL=admin@yourdomain.com

# =============================================================================
# REDIS CONFIGURATION (High Availability with Sentinel)
# =============================================================================

# Redis client (predis for Sentinel support)
REDIS_CLIENT=predis
REDIS_CLUSTER=redis
REDIS_REPLICATION=sentinel
REDIS_SENTINEL_SERVICE=mymaster

# Redis connection settings
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here
REDIS_URL=redis://:password@127.0.0.1:6379

# Redis database separation
REDIS_DB=0
REDIS_CACHE_DB=1
REDIS_QUEUE_DB=2
REDIS_SESSION_DB=3

# Redis prefix for namespacing
REDIS_PREFIX=hcrm_bridge_

# =============================================================================
# QUEUE CONFIGURATION
# =============================================================================

QUEUE_CONNECTION=redis
QUEUE_FAILED_DRIVER=database-uuids

# Queue worker settings
QUEUE_WORKER_TIMEOUT=120
QUEUE_WORKER_TRIES=5
QUEUE_WORKER_BACKOFF=60,120,300,600,1800

# =============================================================================
# CACHE CONFIGURATION
# =============================================================================

CACHE_DRIVER=redis
CACHE_PREFIX=bridge_cache
CACHE_TTL=3600

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================

SESSION_DRIVER=redis
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null
SESSION_SECURE_COOKIE=true
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=lax

# =============================================================================
# SECURITY CONFIGURATION (API v2.1 Enhanced)
# =============================================================================

# Sanctum token configuration
SANCTUM_STATEFUL_DOMAINS=localhost,localhost:3000,localhost:8080,127.0.0.1,127.0.0.1:8000,127.0.0.1:3000,127.0.0.1:8080,::1
SANCTUM_TOKEN_PREFIX=hcrm_bridge_

# CORS configuration
CORS_ALLOWED_ORIGINS=https://krayin.yourdomain.com,https://chatwoot.yourdomain.com
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Accept,Accept-Language,Authorization,Content-Type,X-Requested-With,X-Chatwoot-Signature,X-Chatwoot-Timestamp,X-Request-ID,X-Forwarded-For,X-Real-IP,User-Agent,Origin,Referer
CORS_EXPOSED_HEADERS=X-RateLimit-Limit,X-RateLimit-Remaining,X-RateLimit-Reset,X-RateLimit-Reset-After,Retry-After,X-Content-Type-Options,X-Frame-Options,X-XSS-Protection,Strict-Transport-Security,Content-Security-Policy,Referrer-Policy,X-Request-ID,X-Response-Time,Cache-Control,ETag,Last-Modified,X-Data-Processing-Consent,X-Privacy-Policy-Version
CORS_MAX_AGE=3600
CORS_SUPPORTS_CREDENTIALS=true

# Rate limiting configuration
RATE_LIMIT_WEBHOOKS_PER_MINUTE=100
RATE_LIMIT_WEBHOOKS_PER_HOUR=1000
RATE_LIMIT_API_PER_MINUTE=60
RATE_LIMIT_API_PER_HOUR=600
RATE_LIMIT_AI_INSIGHTS_PER_MINUTE=30
RATE_LIMIT_AI_INSIGHTS_PER_HOUR=300
RATE_LIMIT_LGPD_EXPORTS_PER_MINUTE=5
RATE_LIMIT_LGPD_EXPORTS_PER_HOUR=20
RATE_LIMIT_AUTH_PER_MINUTE=5
RATE_LIMIT_AUTH_PER_HOUR=20

# Webhook security settings
WEBHOOK_MAX_PAYLOAD_SIZE=1048576
WEBHOOK_TIMESTAMP_TOLERANCE=300
WEBHOOK_IDEMPOTENCY_TTL=86400

# =============================================================================
# KRAYIN CRM INTEGRATION
# =============================================================================

# Krayin API configuration
KRAYIN_URL=https://krayin.yourdomain.com
KRAYIN_API_TOKEN=your_krayin_api_token_here
KRAYIN_API_TIMEOUT=10
KRAYIN_API_RETRY_ATTEMPTS=3
KRAYIN_API_RETRY_DELAY=1000

# Krayin API endpoints
KRAYIN_API_BASE_URL=https://krayin.yourdomain.com/api
KRAYIN_LEADS_ENDPOINT=/leads
KRAYIN_ACTIVITIES_ENDPOINT=/activities
KRAYIN_PIPELINES_ENDPOINT=/pipelines
KRAYIN_STAGES_ENDPOINT=/stages

# Krayin authentication
KRAYIN_AUTH_TYPE=bearer
KRAYIN_AUTH_HEADER=Authorization

# =============================================================================
# CHATWOOT INTEGRATION
# =============================================================================

# Chatwoot API configuration
CHATWOOT_URL=https://chatwoot.yourdomain.com
CHATWOOT_API_TOKEN=your_chatwoot_api_token_here
CHATWOOT_API_TIMEOUT=10
CHATWOOT_API_RETRY_ATTEMPTS=3
CHATWOOT_API_RETRY_DELAY=1000

# Chatwoot API endpoints
CHATWOOT_API_BASE_URL=https://chatwoot.yourdomain.com/api/v1
CHATWOOT_CONVERSATIONS_ENDPOINT=/conversations
CHATWOOT_MESSAGES_ENDPOINT=/messages
CHATWOOT_CONTACTS_ENDPOINT=/contacts
CHATWOOT_ACCOUNTS_ENDPOINT=/accounts

# Chatwoot webhook configuration
CHATWOOT_WEBHOOK_SECRET=your_webhook_secret_here
CHATWOOT_WEBHOOK_TIMESTAMP_ENABLED=true
CHATWOOT_WEBHOOK_RETRY_ATTEMPTS=3
CHATWOOT_WEBHOOK_RETRY_BACKOFF=exponential

# Chatwoot authentication
CHATWOOT_AUTH_TYPE=bearer
CHATWOOT_AUTH_HEADER=Authorization

# =============================================================================
# LGPD COMPLIANCE CONFIGURATION
# =============================================================================

# LGPD general settings
LGPD_CONSENT_VERSION=2.1
LGPD_RETENTION_DAYS=1825
LGPD_DATA_PROCESSING_PURPOSE=healthcare_crm_authentication
LGPD_PRIVACY_POLICY_URL=https://yourdomain.com/privacy-policy
LGPD_TERMS_OF_SERVICE_URL=https://yourdomain.com/terms-of-service

# LGPD consent texts (Portuguese for Brazilian compliance)
LGPD_CONSENT_DATA_PROCESSING="Autorizo o processamento dos meus dados pessoais conforme a Lei Geral de Proteção de Dados (LGPD)."
LGPD_CONSENT_MARKETING="Autorizo o envio de comunicações de marketing."
LGPD_CONSENT_HEALTH_DATA="Autorizo o armazenamento e processamento de dados sensíveis de saúde para fins de atendimento médico."

# LGPD data retention settings
LGPD_ANONYMIZATION_ENABLED=true
LGPD_ANONYMIZATION_AFTER_DAYS=365
LGPD_DELETION_ENABLED=true
LGPD_DELETION_AFTER_DAYS=1825

# LGPD audit settings
LGPD_AUDIT_LOGGING=true
LGPD_AUDIT_RETENTION_DAYS=2555
LGPD_AUDIT_ENCRYPTION=true

# LGPD encryption settings
LGPD_ENCRYPTION_KEY=your_encryption_key_here
LGPD_ENCRYPTION_CIPHER=AES-256-CBC

# =============================================================================
# AI INSIGHTS CONFIGURATION
# =============================================================================

# AI insights calculation settings
AI_INSIGHTS_ENABLED=true
AI_INSIGHTS_CALCULATION_INTERVAL=3600
AI_INSIGHTS_CACHE_TTL=3600
AI_INSIGHTS_HISTORY_RETENTION_DAYS=90

# AI insights performance thresholds
AI_INSIGHTS_HIGH_ENGAGEMENT_THRESHOLD=8.0
AI_INSIGHTS_MEDIUM_ENGAGEMENT_THRESHOLD=5.0
AI_INSIGHTS_FAST_RESPONSE_THRESHOLD=5
AI_INSIGHTS_SLOW_RESPONSE_THRESHOLD=30

# AI insights suggestions
AI_INSIGHTS_SUGGESTIONS_ENABLED=true
AI_INSIGHTS_SUGGESTIONS_MAX_COUNT=5
AI_INSIGHTS_SUGGESTIONS_PRIORITY_WEIGHTS=high:3,medium:2,low:1

# =============================================================================
# MONITORING AND HEALTH CHECKS
# =============================================================================

# Health check configuration
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=5
HEALTH_CHECK_RETRY_ATTEMPTS=3

# Monitoring endpoints
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_KRAYIN_API=true
HEALTH_CHECK_CHATWOOT_API=true
HEALTH_CHECK_QUEUE=true

# Alerting configuration
ALERTING_ENABLED=true
ALERTING_WEBHOOK_URL=https://alerts.yourdomain.com/webhook
ALERTING_EMAIL=admin@yourdomain.com
ALERTING_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# Metrics collection
METRICS_ENABLED=true
METRICS_COLLECTION_INTERVAL=60
METRICS_RETENTION_DAYS=30

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Logging settings
LOG_CHANNEL=stack
LOG_LEVEL=info
LOG_DEPRECATIONS_CHANNEL=null
LOG_STACK=stack

# Log file settings
LOG_MAX_FILES=30
LOG_MAX_SIZE=10485760

# Structured logging
LOG_STRUCTURED=true
LOG_CONTEXT_INCLUDED=true

# Security logging
LOG_SECURITY_EVENTS=true
LOG_AUTHENTICATION_ATTEMPTS=true
LOG_WEBHOOK_ATTEMPTS=true
LOG_RATE_LIMIT_VIOLATIONS=true

# =============================================================================
# MAIL CONFIGURATION
# =============================================================================

MAIL_MAILER=smtp
MAIL_HOST=smtp.yourdomain.com
MAIL_PORT=587
MAIL_USERNAME=noreply@yourdomain.com
MAIL_PASSWORD=your_smtp_password_here
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@yourdomain.com
MAIL_FROM_NAME="${APP_NAME}"

# =============================================================================
# FILE STORAGE CONFIGURATION
# =============================================================================

FILESYSTEM_DISK=local
FILESYSTEM_CLOUD=s3

# AWS S3 configuration (for file storage)
AWS_ACCESS_KEY_ID=your_aws_access_key_here
AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=hcrm-bridge-storage
AWS_USE_PATH_STYLE_ENDPOINT=false

# =============================================================================
# DOCKER AND DEPLOYMENT CONFIGURATION
# =============================================================================

# Docker configuration
DOCKER_NETWORK=bridge_network
DOCKER_COMPOSE_PROJECT=hcrm_bridge

# Deployment settings
DEPLOYMENT_ENVIRONMENT=production
DEPLOYMENT_VERSION=2.1.0
DEPLOYMENT_BUILD_NUMBER=1

# Container settings
CONTAINER_MEMORY_LIMIT=512m
CONTAINER_CPU_LIMIT=0.5
CONTAINER_RESTART_POLICY=unless-stopped

# =============================================================================
# DEVELOPMENT AND TESTING CONFIGURATION
# =============================================================================

# Development settings (only for local development)
APP_DEBUG_LOCAL=false
TELESCOPE_ENABLED=false
HORIZON_ENABLED=false

# Testing settings
TESTING_DATABASE=bridge_testing
TESTING_REDIS_DB=15
TESTING_CACHE_PREFIX=test_bridge_

# =============================================================================
# SECURITY HEADERS CONFIGURATION
# =============================================================================

# Security headers
SECURITY_HEADERS_ENABLED=true
SECURITY_HEADERS_HSTS_MAX_AGE=31536000
SECURITY_HEADERS_CSP_ENABLED=true
SECURITY_HEADERS_X_FRAME_OPTIONS=DENY
SECURITY_HEADERS_X_CONTENT_TYPE_OPTIONS=nosniff
SECURITY_HEADERS_X_XSS_PROTECTION=1; mode=block

# Content Security Policy
CSP_DEFAULT_SRC='self'
CSP_SCRIPT_SRC='self' 'unsafe-inline'
CSP_STYLE_SRC='self' 'unsafe-inline'
CSP_IMG_SRC='self' data: https:
CSP_CONNECT_SRC='self'
CSP_FRAME_ANCESTORS='none'
CSP_BASE_URI='self'
CSP_FORM_ACTION='self'

# =============================================================================
# PERFORMANCE CONFIGURATION
# =============================================================================

# Performance settings
PERFORMANCE_OPTIMIZATION=true
PERFORMANCE_CACHE_ENABLED=true
PERFORMANCE_COMPRESSION_ENABLED=true
PERFORMANCE_HTTP2_ENABLED=true

# Memory settings
MEMORY_LIMIT=512M
MEMORY_PEAK_USAGE_LIMIT=256M

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================

# Backup settings
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE=s3
BACKUP_ENCRYPTION=true

# Backup storage
BACKUP_S3_BUCKET=hcrm-bridge-backups
BACKUP_S3_REGION=us-east-1
BACKUP_S3_PATH=backups/

# =============================================================================
# NOTIFICATION CONFIGURATION
# =============================================================================

# Notification settings
NOTIFICATIONS_ENABLED=true
NOTIFICATIONS_CHANNELS=mail,slack,webhook

# Slack notifications
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
SLACK_CHANNEL=#hcrm-alerts
SLACK_USERNAME=HCrm Bridge Bot

# Webhook notifications
NOTIFICATION_WEBHOOK_URL=https://notifications.yourdomain.com/webhook
NOTIFICATION_WEBHOOK_SECRET=your_notification_webhook_secret_here

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Feature toggles
FEATURE_AI_INSIGHTS=true
FEATURE_LGPD_COMPLIANCE=true
FEATURE_WEBHOOK_PROCESSING=true
FEATURE_RATE_LIMITING=true
FEATURE_HEALTH_MONITORING=true
FEATURE_AUDIT_LOGGING=true
FEATURE_DATA_EXPORT=true
FEATURE_DATA_DELETION=true

# =============================================================================
# INTEGRATION TESTING
# =============================================================================

# Integration testing endpoints
TESTING_KRAYIN_URL=https://test-krayin.yourdomain.com
TESTING_CHATWOOT_URL=https://test-chatwoot.yourdomain.com
TESTING_WEBHOOK_SECRET=test_webhook_secret_123

# Testing credentials
TESTING_KRAYIN_API_TOKEN=test_krayin_token_123
TESTING_CHATWOOT_API_TOKEN=test_chatwoot_token_123

# =============================================================================
# END OF CONFIGURATION
# =============================================================================
#
# Remember to:
# 1. Copy this file to .env
# 2. Update all placeholder values with your actual configuration
# 3. Generate a secure APP_KEY using: php artisan key:generate
# 4. Never commit the .env file to version control
# 5. Use strong, unique passwords for all services
# 6. Enable SSL/TLS for all external connections
# 7. Regularly rotate API tokens and secrets
# 8. Monitor logs for security events
#
# For production deployment, ensure all security settings are properly configured
# and all external services are accessible with proper authentication.
# =============================================================================
